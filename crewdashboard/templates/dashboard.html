{% extends 'base.html' %}
{% block content %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <h2 style = "font-style: italic; text-align: center; margin-left: auto; margin-right:auto">Cleaning Crews, We Need Your Help!</h2>
    <script>
      counter = 0
        function updateTable(){
        var tempCounter = counter;
        // AJAX GET melakukan append data
        $.get("{% url 'crewdashboard:json' %}", function(data) {
          var card = document.getElementById("card-deck");
          card.innerHTMLL = ""
          let string = ``
            for(var i = counter; i < data.length; i++){
                string += `
                  <div class="card-group">
                      <div class = "card border-dark mb-2 bg-light p-3">
                          <div class="card-header">
                              <small class = "card-date">${data[i].fields.date}</small>
                          </div>
                          <div class="card-body">
                              <small class="card-title">Urgency level: ${data[i].fields.urgency}</small>
                            <div>
                                <small class="card-description">Description: ${data[i].fields.description}</small>
                            </div>
                          </div>
                          <div class="card-footer">
                            <small class="card-description">${data[i].fields.location}</small>
                          </div>
                      </div>
                  </div>
                `
                tempCounter++;
            }
            card.innerHTML = string
            let str = document.getElementById("cardBody").innerHTML;
            let res = str.replace(/\\n/g, '<br> <br>');
            document.getElementById("cardBody").innerHTML = res;
          
            counter = tempCounter;
          });
        }

        // Melakukan refresh ketika button diklik
        $(document).ready(function(){
          updateTable();
        })
  
    </script>
</head>


<div class="container">

</div>
  <div class="card align-items-center justify-content-center" >
    <form class="text-center" method = "POST">
        {% csrf_token %}
          <div class = "d-flex flex-start justify-content-around" id="card-deck" style="flex-wrap: wrap">
            <div class="p-2"></div>
          </div>
    </form>
    <p><button class="btn btn-outline-light btn-warning btn-sm px-3"><a href="{% url 'authc:logout' %}">Logout</a></button></p>
  </div>


<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@700&family=Poppins:wght@400;500;600&display=swap');
  *{
      font-family: "Poppins";
  } .container{

   
  }.card{
    border: none;
  } body{
/* 
    background-image: url("https://images.unsplash.com/photo-1506619216599-9d16d0903dfd?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2069&q=80");
    background-position: center;
    background-size: cover;
    background-repeat: no-repeat; */
  } 
</style>

{% endblock content %}