{% extends 'base.html' %}
{% block content %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <h2 style = "font-style: italic; margin-top: 20px; text-align: center; margin-left: auto; margin-right:auto">Welcome, {{ user }}!</h2>
    <script>
      counter = 0
        function updateTable(){
        var tempCounter = counter;
        // AJAX GET melakukan append data
        $.get("{% url 'crewdashboard:json' %}", function(data) {
            for(var i = counter; i < data.length; i++){
                var tr = document.createElement("tr"); //row

                var thDate = document.createElement("th"); //data
                var thTitle = document.createElement("th"); //data                
                var thDescription = document.createElement("th"); //data
                               
                thDate.append(data[i].fields.date);
                thTitle.append(data[i].fields.title);
                thDescription.append(data[i].fields.description);

                //append data to row
                tr.append(thDate);
                tr.append(thTitle);
                tr.append(thDescription);
                
                //append row to table
                $(".table").append(tr);
                tempCounter++;
            }
            counter = tempCounter;
          });
        }

        // Melakukan refresh ketika button diklik
        // $(document).ready(function(){
        //   $("#get").click(function(){
        //     updateTable();
        //   });
        // })
  
        // Melakukan GET POST ketika submit form
        // $(document).on('submit', '#form_post', function(e){
        //   e.preventDefault();
        //   $.ajax({
        //     type:"POST",
        //     url:"{% url 'crewdashboard:addlocation' %}",
        //     data:{
        //       location:$("#title").val(),
        //       image:$("#image").val(),
        //       urgency:$("#urgency").val(),
        //       description:$("#description").val(),
        //       csrfmiddlewaretoken:'{{ csrf_token }}',
        //     },
        //     dataType: 'json',
            
        //     success: function(response) {
        //       updateTable();
        //       location.reload();
        //     },
        //   })
        // });

      
    </script>
</head>

<table class = "table table-sm table-light" style = "text-align: center; margin-left: auto; margin-right:auto">
  <thead>
    <tr>
    <th>Date</th>
    <th>Location</th>
    <th>Urgency</th>
    <th>Description</th>
    <th>Status Image</th>
    </tr>
  </thead>
</table>

<div class="card align-items-center justify-content-center" >
  <form class="text-center" method = "POST">
      {% csrf_token %}
        <div class = "card-deck">
            {% for task in crewdashboard.all %} 
            <div class="card-group">
                <div class = "card border-dark mb-2 bg-light p-3">
                    <div class="card-header">
                        <small class = "card-date">{{ task.date }}</small>
                    </div>
                    <div class="card-body">
                        <small class="card-title">{{ task.title }}</small>
                    </div>
                    <div class="card-footer">
                        <small class="card-description">{{ task.description }}</small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
  </form>
</div>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@700&family=Poppins:wght@400;500;600&display=swap');
  *{
      box-sizing: border-box;
      font-family: "Poppins";
  }
  body{
      min-height: 100vh;
      background-image: url("https://images.unsplash.com/photo-1506619216599-9d16d0903dfd?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2069&q=80");

  } button{
    margin: 0;
    position: absolute;
    left: 50%;
    -ms-transform: translateX(-50%);
    transform: translateX(-50%);
  } 
</style>

{% endblock content %}